<?php 	class Product_subcategory_manage extends CI_Model {		public function __construct()		{			//parent::__construct();		}					public function add_subcategory_manage($params=array())		{			try {								$sub_category_name=$params['sub_category_name'];				$product_category_id=$params['product_category_id'];				$sub_category_status=$params['sub_category_status'];				$data = array(						'sub_category_name' => $sub_category_name,					'product_category_id' => $product_category_id,					'sub_category_status' => $sub_category_status					);				$sql = "INSERT INTO `ve_product_sub_category`(`sub_category_name`, `product_category_id`, sub_category_status) VALUES ('".$this->db->escape_str($sub_category_name)."', '".$product_category_id."', '".$sub_category_status."')";				//echo $sql;exit;				$this->db->query($sql);				$lastid= $this->db->insert_id();								$result['data'] =  $lastid;				$result['success'] = true;				$result['error'] = '';			}			catch(Exception $e)			{				$result['success'] = false;				$result['error'] = $e->getMessage();			}			return $result;		}		public function edit_productsubcategory_manage($params=array())		{					//print_r($params); exit;			try {				$product_sub_category_id = $params['product_sub_category_id'];				$sql = "UPDATE `ve_product_sub_category` SET sub_category_name = :sub_category_name, product_category_id = :product_category_id, sub_category_status = :sub_category_status WHERE product_sub_category_id = :product_sub_category_id";				$stmt2 = $this->db->conn_id->prepare($sql);									$stmt2->bindParam("sub_category_name", $params['formdata']['subcat_name']);				$stmt2->bindParam("product_category_id", $params['formdata']['cat_id']);				$stmt2->bindParam("sub_category_status", $params['subcategory_status']);				$stmt2->bindParam("product_sub_category_id",$product_sub_category_id);					if($stmt2->execute()){						$result['success'] = true;						$result['message'] = "Product subcategory successfully Updated";						$result['error'] = '';					}else {						$result['success'] = false;						$result['message'] = "Sorry please try again";					}				}				catch(Exception $e)				{					$result['success'] = false;					$result['error'] = $e->getMessage();				}			return $result;		}		public function delete_productsubcategory($params=array()){			try{				$product_sub_category_id = (isset($params['product_sub_category_id']) && $params['product_sub_category_id']!='') ? $params['product_sub_category_id'] :'';				if(isset($product_sub_category_id) && $product_sub_category_id!='')				{					$this->db->where('product_sub_category_id',$product_sub_category_id);					$this->db->delete('ve_product_sub_category');										$this->db->set('product_sub_category_id',0);					$this->db->where('product_sub_category_id',$product_sub_category_id);										$this->db->update('ve_product_master');				}				$result['success'] = true;				$result['error'] = '';			}			catch(Exception $e){				$result['success'] = false;				$result['error'] = $e->getMessage();			}			return $result;		}
		public function formfilelist($params=array()){			if(isset($params['groupuser']) && $params['groupuser']=='editform'){				$sql = "SELECT * FROM `ve_product_sub_category` WHERE 1 ";			}			else{				$sql = "SELECT * FROM `ve_product_sub_category` ps JOIN ve_product_category d ON (d.product_category_id = ps.product_category_id) WHERE 1 ";			}			try {				$product_sub_category_id=(isset($params['product_sub_category_id'])) ? $params['product_sub_category_id'] : '';				if(isset($product_sub_category_id) && $product_sub_category_id!='')				{					$sql.=" AND `product_sub_category_id`='".$product_sub_category_id."'";				}				if(isset($params['search_term']) && $params['search_term'] != ''){					$sql.=" AND ( ps.`sub_category_name` LIKE '%".$params['search_term']."%' OR d.`category_name` LIKE '%".$params['search_term']."%') ";				}				$offset=(isset($params['offset'])) ? $params['offset'] : '';				$limit=(isset($params['limit'])) ? $params['limit'] : '';				if(isset($offset) && $offset != '')
				{					$sql.=" limit $offset ";				}				if(isset($limit) && $limit != '')				{					$sql.=" , $limit";				}				$sql .= " ORDER BY product_sub_category_id DESC";				//echo $sql;					$query = $this->db->query($sql);				//print_r($query );exit;				$total_count=(isset($params['total_count'])) ? $params['total_count'] : '';				if(isset($total_count) && $total_count=='yes')				{					$datalist = $query->num_rows();				}				else{					$datalist = $query->result_array();				}				$result['success'] = true;				$result['data'] =  $datalist;				$result['error'] = '';			}			catch(Exception $e)			{				$result['success'] = false;				$result['error'] = $e->getMessage();			}			return $result;		}	}	